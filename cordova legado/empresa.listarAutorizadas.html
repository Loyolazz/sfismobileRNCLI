<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://maps.googleapis.com/ https://maps.gstatic.com/ https://mts0.googleapis.com/ 'unsafe-inline' 'unsafe-eval'">

    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/empresa-listar.css">
    <!--Import Google Icon Font-->
    <link type="text/css" rel="stylesheet" href="fonts/material-icons.css" media="screen,projection" />

    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
    <link rel="stylesheet" type="text/css" href="css/padrao.css">
</head>
<body ng-app="app">
    <div ng-controller="MainCtrl">

        <div class="navbar-fixed">
            <nav class="nav">
                <a onclick="window.history.back()" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">arrow_back</i></a>
                <a href="#" class="brand-logo left nav-text"> Empresas Encontradas </a>
            </nav>
        </div>

        <div class="fixed">
            <!--<p class="titulo"> {{empresas.length}} localizada(s).</p>-->
            <p id="data-qtd" class="titulo"></p>
            <p class="detalhe-info">
                A pesquisa "{{filtro}}".
                Escolha uma para visualizar sua frota ou localização do terminal.
            </p>
        </div>

        <div class="app">
            <div class="lista-empresa">
                <ul class="collection" ng-repeat="empresa in empresas">

                    <li class="collection-item avatar">
                        <a ng-click="detalhar(empresa);">

                            <img src="{{empresa.icone}}" alt="" class="circle">
                            <span class="title">{{empresa.NORazaoSocial}}</span>
                            <i class="material-icons right">chevron_right</i>

                            <p class="detalhe"> CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}} </b></p>
                            <p class="detalhe"> Endereço: <b> {{empresa.DSEndereco}} </b></p>
                            <p class="detalhe" nrinstrumento> Modalidade: <b> {{empresa.Modalidade}} </b></p>

                            <p class="detalhe" ng-show="empresa.NRInstrumento"> Instrumento: <b> {{empresa.NRInstrumento}} </b></p>
                            <!--<p class="detalhe"><b>{{empresa.DescricaoNRInstrumento}} </b></p>-->

                            <p class="detalhe" ng-hide="empresa.DTAditamento == '01/01/1900 00:00:00' || !empresa.DTAditamento"> Data Último Aditamento: <b> {{formatarData(empresa.DTAditamento)}} </b></p>
                            <p class="detalhe" ng-show="empresa.NRAditamento"> Termo: <b> {{empresa.NRAditamento}} </b></p>
                            <p class="detalhe" ng-show="empresa.QTDEmbarcacao"> Embarcações: <b>{{empresa.QTDEmbarcacao}}</b> </p>
                            <p class="detalhe" ng-show="empresa.norma == 1274 || empresa.norma == 3285"> Travessia: <b>{{empresa.Instalacao}}</b> </p>
                            <p class="detalhe" ng-show="empresa.norma == 912"> Linha: <b>{{empresa.Instalacao}}</b> </p>
                            <p class="detalhe" ng-show="empresa.norma!=1274 && empresa.norma!=912 && empresa.norma!=3285 && empresa.Instalacao"> Instalação: <b>{{empresa.Instalacao}}</b> </p>
                            <p class="detalhe" ng-show="empresa.NRInscricaoInstalacao && empresa.NRInscricaoInstalacao != empresa.NRInscricao"> CNPJ Instalação: <b>{{formatarNRCnpj(empresa.NRInscricaoInstalacao)}} </b></p>
                            <p class="detalhe" ng-show="empresa.NRInscricaoInstalacao && empresa.NRInscricaoInstalacao != empresa.NRInscricao"> Razão Social Instalação: <b>{{empresa.NORazaoSocialInstalacao}} </b></p>
                            <!--<div class="empresa-ativa"> <img src="img/status-atividade.png">  {{st_empresa}} </div> -->
                        </a>
                        <small style="display: inline-block; padding: 7px 0"><b><a ng-click="exibirHistorico(empresa);"> Histórico de fiscalizações<i class="material-icons left">search</i></a></b></small>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Modal estrutura -->
        <div id="modal_historico" class="modal modal-historico">
            <div id="passoProcessosAndamento" class="modal-passo">
                <div class="modal-content">
                    <h5><b>Histórico de Fiscalizações</b></h5>
                    <p class="info">Empresa: <b>{{empresa.NORazaoSocial}}</b></p>
                    <p class="info">CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}}</b></p>
                    <div class="modal-buttons" ng-show="historicoEmAndamento.length > 10">
                        <a ng-click="selecionarPasso('#passoSancionadoresJulgados')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Sancionadores Julgados <i class="material-icons">navigate_next</i></a>
                        <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                    </div>
                    <span class="card-title" aling="center"><h5>Processos em Andamento</h5></span>
                    <div  ng-show="historicoEmAndamento.length == 0"><h6><u>Não existem Processos em Andamento</u></h6></div>
                    <table class="striped" ng-show="historicoEmAndamento.length > 0">
                        <thead class="hide-on-small-only">
                            <tr>
                                <th>Nº do Processo</th>
                                <th>Tipo de Fiscalização</th>
                                <th>Situação do Processo</th>
                                <th>Nº do Auto de Infração</th>
                                <th>Código da Irregularidade</th>
                                <th>Tipo de Infração</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="hist in historicoEmAndamento">
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Processo</b>
                                </div>
                                <div class="left-align">{{hist.CodProcessoFormatado}}</div>
                              </td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Fiscalização</b>
                                </div>
                                <div class="left-align">{{hist.TipoFiscalizacao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Situação do Processo</b>
                                </div>
                                <div class="left-align">{{hist.SituacaoProcesso == '-' ? 'Não submetido' : hist.SituacaoProcesso}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Auto de Infração</b>
                                </div>
                                <div class="left-align">{{hist.NRAutoInfracao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Código da Irregularidade</b>
                                </div>
                                <div class="left-align">{{hist.DSIrregularidadeIE}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Infração</b>
                                </div>
                                <div class="left-align">{{hist.TipoInfracao}}</div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <a ng-click="selecionarPasso('#passoSancionadoresJulgados')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Sancionadores Julgados <i class="material-icons">navigate_next</i></a>
                    <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                </div>
            </div>
            <div id="passoSancionadoresJulgados" class="modal-passo hide">
                <div class="modal-content">
                    <h5><b>Histórico de Fiscalizações</b></h5>
                    <p class="info">Empresa: <b>{{empresa.NORazaoSocial}}</b></p>
                    <p class="info">CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}}</b></p>
                    <div class="modal-buttons" ng-show="historicoJulgados.length > 10">
                        <a ng-click="selecionarPasso('#passoProcessosAndamento')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Processos em Andamento</a>
                        <a ng-click="selecionarPasso('#passoAutosInfracao')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Autos de Infração <i class="material-icons">navigate_next</i></a>
                        <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                    </div>
                    <span class="card-title" aling="center"><h5>Sancionadores Julgados</h5></span>
                    <div  ng-show="historicoJulgados.length == 0"><h6><u>Não existem Sancionadores Julgados</u></h6></div>
                    <table class="striped" ng-show="historicoJulgados.length > 0">
                        <thead class="hide-on-small-only">
                            <tr>
                                <th>Nº do Processo</th>
                                <th>Tipo de Fiscalização</th>
                                <th>Código da Irregularidade</th>
                                <th>Nº do Auto de Infração</th>
                                <th>Tipo de Decisão</th>
                                <th>Valor da Multa</th>
                                <th>Situação do Processo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="hist in historicoJulgados">
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Processo</b>
                                </div>
                                <div class="left-align">{{hist.CodProcessoFormatado}}</div>
                              </td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Fiscalização</b>
                                </div>
                                <div class="left-align">{{hist.TipoFiscalizacao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Código da Irregularidade</b>
                                </div>
                                <div class="left-align">{{hist.DSIrregularidadeIE}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Auto de Infração</b>
                                </div>
                                <div class="left-align">{{hist.NRAutoInfracao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Decisão</b>
                                </div>
                                <div class="left-align">{{hist.TipoDecisao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Valor da Multa</b>
                                </div>
                                <div class="left-align">{{hist.VLMulta ? hist.VLMulta : '-'}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Situação do Processo</b>
                                </div>
                                <div class="left-align">{{hist.SituacaoProcesso == '-' ? 'Não submetido' : hist.SituacaoProcesso}}</div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <a ng-click="selecionarPasso('#passoProcessosAndamento')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Processos em Andamento</a>
                    <a ng-click="selecionarPasso('#passoAutosInfracao')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Autos de Infração <i class="material-icons">navigate_next</i></a>
                    <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                </div>
            </div>
            <div id="passoAutosInfracao" class="modal-passo hide">
                <div class="modal-content">
                    <h5><b>Histórico de Fiscalizações</b></h5>
                    <p class="info">Empresa: <b>{{empresa.NORazaoSocial}}</b></p>
                    <p class="info">CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}}</b></p>
                    <div class="modal-buttons" ng-show="historicoAutoInfracao.length > 10">
                        <a ng-click="selecionarPasso('#passoSancionadoresJulgados')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Sancionadores Julgados</a>
                        <a ng-click="selecionarPasso('#passoNotificacoes')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Notificações <i class="material-icons">navigate_next</i></a>
                        <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                    </div>
                    <span class="card-title" aling="center"><h5>Autos de Infração</h5></span>
                    <div  ng-show="historicoAutoInfracao.length == 0"><h6><u>Não existem Autos de Infração</u></h6></div>
                    <table class="striped" ng-show="historicoAutoInfracao.length > 0">
                        <thead class="hide-on-small-only">
                            <tr>
                                <th>Nº do Auto de Infração</th>
                                <th>Data da ciência</th>
                                <th>Código da Irregularidade</th>
                                <th>Tipo de Infração</th>
                                <th>Nº do Processo</th>
                                <th>Situação do Processo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="hist in historicoAutoInfracao">
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Auto de Infração</b>
                                </div>
                                <div class="left-align">{{hist.NRAutoInfracao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Data da ciência</b>
                                </div>
                                <div class="left-align">{{hist.DTCiencia}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Código da Irregularidade</b>
                                </div>
                                <div class="left-align">{{hist.DSIrregularidadeIE}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Infração</b>
                                </div>
                                <div class="left-align">{{hist.TipoInfracao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Processo</b>
                                </div>
                                <div class="left-align">{{hist.CodProcessoFormatado}}</div>
                              </td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Situação do Processo</b>
                                </div>
                                <div class="left-align">{{hist.SituacaoProcesso == '-' ? 'Não submetido' : hist.SituacaoProcesso}}</div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <a ng-click="selecionarPasso('#passoSancionadoresJulgados')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Sancionadores Julgados</a>
                    <a ng-click="selecionarPasso('#passoNotificacoes')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Notificações <i class="material-icons">navigate_next</i></a>
                    <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                </div>
            </div>
            <div id="passoNotificacoes" class="modal-passo hide">
                <div class="modal-content">
                    <h5><b>Histórico de Fiscalizações</b></h5>
                    <p class="info">Empresa: <b>{{empresa.NORazaoSocial}}</b></p>
                    <p class="info">CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}}</b></p>
                    <div class="modal-buttons" ng-show="historicoNotificacao.length > 10">
                        <a ng-click="selecionarPasso('#passoAutosInfracao')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Autos de Infração</a>
                        <a ng-click="selecionarPasso('#passoAcoesFiscalizadoras')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Ações Fiscalizadoras <i class="material-icons">navigate_next</i></a>
                        <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                    </div>
                    <span class="card-title" aling="center"><h5>Notificações de Correção de Irregularidade (NOCI)</h5></span>
                    <div  ng-show="historicoNotificacao.length == 0"><h6><u>Não existem Notificações de Correção de Irregularidade (NOCI)</u></h6></div>
                    <table class="striped" ng-show="historicoNotificacao.length > 0">
                        <thead class="hide-on-small-only">
                            <tr>
                                <th>Nº da NOCI</th>
                                <th>Data da ciência</th>
                                <th>Código da Irregularidade</th>
                                <th>Tipo de Infração</th>
                                <th>Nº do Processo</th>
                                <th>Sanada?</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="hist in historicoNotificacao">
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº da NOCI</b>
                                </div>
                                <div class="left-align">{{hist.NRNotificacao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Data da ciência</b>
                                </div>
                                <div class="left-align">{{hist.DTCiencia}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Código da Irregularidade</b>
                                </div>
                                <div class="left-align">{{hist.DSIrregularidadeIE}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Tipo de Infração</b>
                                </div>
                                <div class="left-align">{{hist.TipoInfracao}}</div></td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Nº do Processo</b>
                                </div>
                                <div class="left-align">{{hist.CodProcessoFormatado}}</div>
                              </td>
                              <td class="block-mobile">
                                <div class="hide-on-med-and-up left margin-small-right margin-small-bottom">
                                    <b>Sanada?</b>
                                </div>
                                <div class="left-align">{{hist.STCorrigida ? 'Sim' : 'Não'}}</div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <a ng-click="selecionarPasso('#passoAutosInfracao')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Autos de Infração</a>
                    <a ng-click="selecionarPasso('#passoAcoesFiscalizadoras')" ng-class="notificacao" class="waves-effect waves-blue btn botao">Ações Fiscalizadoras <i class="material-icons">navigate_next</i></a>
                    <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                </div>
            </div>
            <div id="passoAcoesFiscalizadoras" class="modal-passo hide">
                <div class="modal-content">
                    <h5><b>Histórico de Fiscalizações</b></h5>
                    <p class="info">Empresa: <b>{{empresa.NORazaoSocial}}</b></p>
                    <p class="info">CNPJ: <b>{{formatarNRCnpj(empresa.NRInscricao)}}</b></p>
                    <span class="card-title" aling="center"><h5>Ações Fiscalizadoras</h5></span>
                    <div ng-show="acoesFiscalizadoras.length == 0"><h6><u>Não existem Ações Fiscalizadoras</u></h6></div>
                    <div ng-show="acoesFiscalizadoras.length > 0">
                        <div class="row">
                            <div class="col s12">
                                <label for="anoReferenciaAcoesFiscalizadoras"><h6>Ano Referência</h6></label>
                                <select name="anoReferenciaAcoesFiscalizadoras" id="anoReferenciaAcoesFiscalizadoras" ng-model="anoReferenciaAcoesFiscalizadoras" ng-options="ano as ano for ano in listaAnosAcoesFiscalizadoras" ng-change="muda()">
                                    <option value="" disabled>(selecione)</option>
                                </select>
                            </div>
                        </div>
                        <table class="striped">
                            <thead>
                                <tr>
                                    <th>Tipo de Fiscalização</th>
                                    <th>Qtd. Ações Fiscalizadoras</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="acao in acoesFiscalizadoras | filter:anoReferenciaAcoesFiscalizadoras">
                                  <td class="center-align">{{acao.TipoFiscalizacao}}</td>
                                  <td class="center-align">{{acao.QTFiscalizacao}}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="row" style="margin-top: 21px" ng-show="acoesFiscalizadoras.length > 0">
                            <p class="sub-title-new" style="margin-left: 16px">
                              Gráfico Ações Fiscalizadoras
                            </p>
                            <div class="nav-screen-panel">
                              <div
                                class="chart-container"
                                style="
                                  position: relative;
                                  height: 30vh;
                                  width: 80vw;
                                  min-height: 180px;
                                "
                              >
                                <canvas id="chart-area"></canvas>
                              </div>
                            </div>
                          </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a ng-click="selecionarPasso('#passoNotificacoes')" ng-class="notificacao" class="waves-effect waves-blue btn botao"><i class="material-icons">navigate_before</i> Notificações</a>
                    <a ng-class="notificacao" class="waves-effect waves-blue btn botao" ng-click="fechar('modal_historico')">Fechar</a>
                </div>
            </div>
        </div>
    </div>
    <div id="preloader" class="preloader-wrapper big active">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div><div class="gap-patch">
                <div class="circle"></div>
            </div><div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>
    <!--JavaScript at end of body for optimized loading-->
    <script src="js/angular.min.js"></script>
    <script src="js/jquery.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="text/javascript" charset="utf-8"  src="js/Chart.min.js"></script>
    <script type="text/javascript" src="js/gestor_bd.js"></script>
    <script type="text/javascript">
        setTimeout(function () {
            $(document).ready(function () {
                $('.modal-historico').modal( { backdrop: 'static', keyboard: false, dismissible: false } )
            });
        }, 1000);
        $(document).ready(function(){
            inicializarMaterializeSelect();
        });
    </script>
    <script src="js/empresa.listarAutorizadas.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
</body>
</html>

